package com.rays.user;

import java.util.Date;
import java.util.List;

import org.hibernate.Criteria;
import org.hibernate.Query;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;

public class UserModel {
	
	public void save(UserDTO dto) {
		dto.setFirstName("Aniket");
		dto.setLastName("Rajput");
		dto.setLoginId("aniket@gmail.com");
		dto.setDob(new Date());
		dto.setPassword("1234");
		dto.setAddress("indore");
		SessionFactory sessionFactory = new Configuration().configure().buildSessionFactory();
		Session session =  sessionFactory.openSession();
		Transaction transaction = session.beginTransaction();
		session.save(dto);
		transaction.commit();
		session.close();
	}
	
	public void update(UserDTO dto) {
		dto.setId(2);
		dto.setFirstName("Aniket");
		dto.setLastName("Rajput");
		dto.setLoginId("aniket@gmail.com");
		dto.setDob(new Date());
		dto.setPassword("1234");
		dto.setAddress("indore");
		SessionFactory sessionFactory = new Configuration().configure().buildSessionFactory();
		Session session =  sessionFactory.openSession();
		Transaction transaction = session.beginTransaction();
		session.update(dto);
		transaction.commit();
		session.close();
	}
	
	public void delete(UserDTO dto) {
		SessionFactory sessionFactory = new Configuration().configure().buildSessionFactory();
		Session session =  sessionFactory.openSession();
		Transaction transaction = session.beginTransaction();
		session.delete(dto);
		transaction.commit();
		session.close();
	}
	
	public UserDTO authenticate(String loginId,String password) {
		SessionFactory sessionFactory = new Configuration().configure().buildSessionFactory();
		Session session =  sessionFactory.openSession();
		Query query =  session.createQuery("from UserDTO where loginId = ? and password = ?");
		query.setString(0, loginId);
		query.setString(2, password);
		List list =  query.list();
		UserDTO dto = null;
		if(list.size()>0) {
			dto = (UserDTO) list.get(0);
		}
		session.close();
		return dto;
		
	}
	
	public List search(UserDTO dto , String pageNo, String pageSize) {
		SessionFactory sessionFactory = new Configuration().configure().buildSessionFactory();
		Session  session =  sessionFactory.openSession();
		Criteria  criteria =  session.createCriteria(UserDTO.class);
		
		
		if(pageSize>0) {
			pageNo = (pageNo-1)*pageSize;
		}
		
		List list =  criteria.list();
		session.close();
		return list;
	}

}
